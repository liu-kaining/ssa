<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡ç¥¨äº¤æ˜“ç­–ç•¥åˆ†æå·¥å…·</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        h1 {
            color: var(--dark-color);
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .card-header {
            background: var(--primary-color);
            color: white;
            padding: 15px 20px;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }
        
        .col {
            flex: 1;
            padding: 0 10px;
        }
        
        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background 0.3s;
            display: inline-block;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-secondary {
            background: var(--secondary-color);
        }
        
        .btn-secondary:hover {
            background: #27ae60;
        }
        

        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.95rem;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .positive {
            color: var(--secondary-color);
            font-weight: 600;
        }
        
        .negative {
            color: var(--danger-color);
            font-weight: 600;
        }
        
        .neutral {
            color: #7f8c8d;
        }
        
        .summary-box {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
        }
        
        .summary-item {
            text-align: center;
            padding: 10px;
            min-width: 150px;
        }
        
        .summary-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 5px 0;
        }
        
        .summary-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .charts-container {
            display: flex;
            flex-direction: column;
            gap: 40px;
            margin: 40px 0;
        }
        
        .chart-wrapper {
            width: 100%;
            height: 700px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: var(--border-radius);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 40px;
            border: 2px solid rgba(52, 152, 219, 0.15);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .chart-wrapper:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 50px rgba(52, 152, 219, 0.25);
            border-color: rgba(52, 152, 219, 0.3);
        }
        
        .chart-wrapper canvas {
            max-height: 550px !important;
        }
        
        .chart-header {
            text-align: center;
            margin-bottom: 25px;
            color: var(--dark-color);
            font-weight: 700;
            font-size: 1.3rem;
            padding: 18px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: var(--border-radius);
            border-bottom: 3px solid var(--primary-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .chart-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 2px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            margin-right: 5px;
        }
        
        .tab.active {
            background: white;
            border-bottom: 1px solid white;
            position: relative;
            top: 1px;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
            padding: 20px 0;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .stock-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .info-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
        }
        
        .info-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .strategy-selector {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .strategy-option {
            flex: 1;
            min-width: 200px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            header {
                margin-bottom: 20px;
                padding: 15px 0;
            }
            
            h1 {
                font-size: 1.8rem;
                margin-bottom: 8px;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .card-body {
                padding: 15px;
            }
            
            .card-header {
                padding: 12px 15px;
                font-size: 1.1rem;
            }
            
            .col {
                flex: 100%;
                margin-bottom: 10px;
            }
            
            .row {
                flex-direction: column;
                margin: 0;
            }
            
            .form-group {
                margin-bottom: 12px;
            }
            
            label {
                font-size: 0.95rem;
                margin-bottom: 4px;
            }
            
            input[type="text"],
            input[type="number"],
            select {
                padding: 12px;
                font-size: 16px; /* é˜²æ­¢iOSç¼©æ”¾ */
                border-radius: 6px;
            }
            
            .btn {
                width: 100%;
                padding: 15px;
                font-size: 1.1rem;
                margin-top: 15px;
            }
            

            
            .summary-box {
                flex-direction: column;
                padding: 12px;
            }
            
            .summary-item {
                margin-bottom: 15px;
                min-width: auto;
            }
            
            .summary-value {
                font-size: 1.3rem;
            }
            
            .summary-label {
                font-size: 0.85rem;
            }
            
            .charts-container {
                flex-direction: column;
                gap: 20px;
                margin: 20px 0;
            }
            
            .chart-wrapper {
                min-width: 100%;
                height: 450px;
                padding: 25px 20px;
            }
            
            .chart-wrapper canvas {
                max-height: 380px !important;
            }
            
            .tabs {
                flex-wrap: wrap;
                margin-bottom: 15px;
            }
            
            .tab {
                flex: 1;
                min-width: 120px;
                padding: 12px 15px;
                font-size: 0.9rem;
                text-align: center;
            }
            
            .stock-info {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .info-item {
                padding: 12px;
            }
            
            .strategy-selector {
                flex-direction: column;
                gap: 15px;
            }
            
            .strategy-option {
                min-width: 100%;
            }
            
            /* ç§»åŠ¨ç«¯è¡¨æ ¼ä¼˜åŒ– */
            table {
                font-size: 0.85rem;
                margin-top: 10px;
            }
            
            th, td {
                padding: 8px 6px;
                font-size: 0.8rem;
            }
            
            /* ç§»åŠ¨ç«¯è¡¨æ ¼æ¨ªå‘æ»šåŠ¨ */
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin: 15px 0;
            }
            
            table {
                min-width: 600px; /* ç¡®ä¿è¡¨æ ¼æœ‰æœ€å°å®½åº¦ */
            }
            
            /* ç§»åŠ¨ç«¯æ ‡ç­¾é¡µå†…å®¹é—´è· */
            .tab-content {
                padding: 15px 0;
            }
            
                    /* ç§»åŠ¨ç«¯å›¾è¡¨æ ‡é¢˜ */
        .chart-header {
            font-size: 1.1rem;
            margin-bottom: 20px;
            padding: 15px;
        }
        
        .chart-header::before {
            width: 50px;
            height: 2px;
        }
        

            
            /* ç§»åŠ¨ç«¯é¡µè„š */
            footer {
                margin-top: 30px;
                padding: 15px;
                font-size: 0.8rem;
            }
            
            footer p {
                margin-bottom: 8px;
            }
        }
        
        /* è¶…å°å±å¹•ä¼˜åŒ– */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .card-body {
                padding: 12px;
            }
            
            .card-header {
                padding: 10px 12px;
                font-size: 1rem;
            }
            
            input[type="text"],
            input[type="number"],
            select {
                padding: 10px;
                font-size: 16px;
            }
            
            .btn {
                padding: 12px;
                font-size: 1rem;
            }
            

            
            .chart-wrapper {
                height: 380px;
                padding: 20px 15px;
            }
            
            .chart-wrapper canvas {
                max-height: 320px !important;
            }
            
            .tab {
                padding: 10px 12px;
                font-size: 0.85rem;
                min-width: 100px;
            }
            
            .summary-value {
                font-size: 1.2rem;
            }
            
            .summary-label {
                font-size: 0.8rem;
            }
            
            /* è¶…å°å±å¹•è¡¨æ ¼å­—ä½“ */
            table {
                font-size: 0.75rem;
            }
            
            th, td {
                padding: 6px 4px;
                font-size: 0.7rem;
            }
        }
        
        /* æ¨ªå±æ¨¡å¼ä¼˜åŒ– */
        @media (max-width: 768px) and (orientation: landscape) {
            .chart-wrapper {
                height: 320px;
            }
            
            .chart-wrapper canvas {
                max-height: 260px !important;
            }
            
            .container {
                padding: 10px;
            }
            
            header {
                margin-bottom: 15px;
                padding: 10px 0;
            }
            
            h1 {
                font-size: 1.5rem;
            }
        }
        
        /* è§¦æ‘¸è®¾å¤‡ä¼˜åŒ– */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                min-height: 44px; /* iOSæ¨èçš„æœ€å°è§¦æ‘¸ç›®æ ‡ */
            }
            
            .tab {
                min-height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            input[type="text"],
            input[type="number"],
            select {
                min-height: 44px;
            }
            
            /* è§¦æ‘¸å‹å¥½çš„è¡¨æ ¼ */
            .table-container {
                -webkit-overflow-scrolling: touch;
                scrollbar-width: thin;
            }
            
            /* è§¦æ‘¸å‹å¥½çš„å›¾è¡¨ */
            .chart-wrapper {
                touch-action: pan-x pan-y;
            }
        }
        
        /* é«˜åˆ†è¾¨ç‡å±å¹•ä¼˜åŒ– */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .chart-wrapper {
                border-width: 0.5px;
            }
            
            input[type="text"],
            input[type="number"],
            select {
                border-width: 0.5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>è‚¡ç¥¨äº¤æ˜“ç­–ç•¥åˆ†æå·¥å…·</h1>
            <p class="subtitle">åŸºäºåŠ¨æ€ä¹°å…¥ç­–ç•¥çš„æ”¶ç›Šåˆ†æä¸å¯è§†åŒ–</p>
        </header>
        
        <div class="card">
            <div class="card-header">è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯</div>
            <div class="card-body">
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="marketType">å¸‚åœºç±»å‹</label>
                            <select id="marketType" onchange="updateMarketSettings()">
                                <option value="HK">æ¸¯è‚¡</option>
                                <option value="US">ç¾è‚¡</option>
                            </select>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="companyName">å…¬å¸åç§°</label>
                            <input type="text" id="companyName" value="ç¾å›¾" required>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="stockCode">è‚¡ç¥¨ä»£ç </label>
                            <input type="text" id="stockCode" value="01357" required>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="currentPrice">å½“å‰è‚¡ä»·</label>
                            <input type="number" id="currentPrice" value="11.19" step="0.01" required>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="historicalHigh">å†å²æœ€é«˜ä»·</label>
                            <input type="number" id="historicalHigh" value="22.83" step="0.01" required>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="historicalLow">å†å²æœ€ä½ä»·</label>
                            <input type="number" id="historicalLow" value="0.43" step="0.01" required>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="week52High">52å‘¨æœ€é«˜ä»·</label>
                            <input type="number" id="week52High" value="12.56" step="0.01" required>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="week52Low">52å‘¨æœ€ä½ä»·</label>
                            <input type="number" id="week52Low" value="1.90" step="0.01" required>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="marketCap">å½“å‰å¸‚å€¼ <span id="marketCapUnit">äº¿æ¸¯å…ƒ</span></label>
                            <input type="number" id="marketCap" value="510.96" step="0.01" required>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="totalShares">æ€»è‚¡æœ¬ (äº¿è‚¡)</label>
                            <input type="number" id="totalShares" value="45.6" step="0.1" required>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="sharesPerHand">æ¯æ‰‹è‚¡æ•°</label>
                            <input type="number" id="sharesPerHand" value="500" step="1" required>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">äº¤æ˜“ç­–ç•¥è®¾ç½®</div>
            <div class="card-body">
                <div class="strategy-selector">
                    <div class="strategy-option">
                        <div class="form-group">
                            <label for="strategyACondition">ç­–ç•¥Aï¼šä»·æ ¼å˜åŒ–æ¡ä»¶</label>
                            <select id="strategyACondition" required>
                                <option value="down">ä¸‹è·Œ</option>
                                <option value="up">ä¸Šæ¶¨</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="strategyAPercentage">ç­–ç•¥Aï¼šç™¾åˆ†æ¯” (%)</label>
                            <input type="number" id="strategyAPercentage" value="10" step="1" required>
                        </div>
                        <div class="form-group">
                            <label for="strategyAHands">ç­–ç•¥Aï¼šè´­å…¥æ‰‹æ•°</label>
                            <input type="number" id="strategyAHands" value="4" step="1" required>
                        </div>
                    </div>
                    
                    <div class="strategy-option">
                        <div class="form-group">
                            <label for="strategyBCondition">ç­–ç•¥Bï¼šä»·æ ¼å˜åŒ–æ¡ä»¶</label>
                            <select id="strategyBCondition" required>
                                <option value="up">ä¸Šæ¶¨</option>
                                <option value="down">ä¸‹è·Œ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="strategyBPercentage">ç­–ç•¥Bï¼šç™¾åˆ†æ¯” (%)</label>
                            <input type="number" id="strategyBPercentage" value="10" step="1" required>
                        </div>
                        <div class="form-group">
                            <label for="strategyBHands">ç­–ç•¥Bï¼šè´­å…¥æ‰‹æ•°</label>
                            <input type="number" id="strategyBHands" value="3" step="1" required>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="totalBudget">æ€»æŠ•èµ„é¢„ç®— <span id="budgetUnit">æ¸¯å…ƒ</span></label>
                            <input type="number" id="totalBudget" value="32000" step="100" required>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="maxBuys">æœ€å¤§ä¹°å…¥æ¬¡æ•°</label>
                            <input type="number" id="maxBuys" value="10" step="1" required>
                        </div>
                    </div>
                </div>
                
                <button class="btn" id="generateStrategyBtn" onclick="calculateStrategies()" disabled>ç”Ÿæˆäº¤æ˜“ç­–ç•¥</button>
            </div>
        </div>
        
        <div id="results" style="display: none;">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('strategyA')">ç­–ç•¥Aåˆ†æ</div>
                <div class="tab" onclick="switchTab('strategyB')">ç­–ç•¥Båˆ†æ</div>
                <div class="tab" onclick="switchTab('comparison')">ç­–ç•¥å¯¹æ¯”</div>
            </div>
            
            <div id="strategyA" class="tab-content active">
                <div class="card">
                    <div class="card-header">ç­–ç•¥Aï¼šä¸‹è·Œ10%æ—¶ä¹°å…¥4æ‰‹</div>
                    <div class="card-body">
                        <div class="summary-box">
                            <div class="summary-item">
                                <div class="summary-value" id="strategyA-totalShares">0</div>
                                <div class="summary-label">æŒæœ‰è‚¡æ•°</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" id="strategyA-totalSpent">0</div>
                                <div class="summary-label">æ€»æ”¯å‡º</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" id="strategyA-remainingBudget">0</div>
                                <div class="summary-label">å‰©ä½™é¢„ç®—</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" id="strategyA-averageCost">0</div>
                                <div class="summary-label">å¹³å‡æˆæœ¬</div>
                            </div>
                        </div>
                        
                        <h3>ä¹°å…¥è®¡åˆ’</h3>
                        <div class="table-container">
                            <table id="strategyA-buyPlan">
                                <thead>
                                    <tr>
                                        <th>åºå·</th>
                                        <th>é¢„æœŸä»·æ ¼</th>
                                        <th>è´­å…¥æ‰‹æ•°</th>
                                        <th>è´­å…¥è‚¡æ•°</th>
                                        <th>æ”¯å‡º</th>
                                        <th>ç´¯è®¡æ”¯å‡º</th>
                                        <th>å‰©ä½™é¢„ç®—</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- åŠ¨æ€ç”Ÿæˆçš„è¡¨æ ¼è¡Œ -->
                                </tbody>
                            </table>
                        </div>
                        
                        <h3 style="margin-top: 30px;">æ”¶ç›Šåˆ†æ</h3>
                        <div class="table-container">
                            <table id="strategyA-profitAnalysis">
                                <thead>
                                    <tr>
                                        <th>ç›®æ ‡ä»·æ ¼</th>
                                        <th>å…¬å¸å¸‚å€¼</th>
                                        <th>æŒä»“ä»·å€¼</th>
                                        <th>æ”¶ç›Š</th>
                                        <th>æ”¶ç›Šç‡</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- åŠ¨æ€ç”Ÿæˆçš„è¡¨æ ¼è¡Œ -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="charts-container">
                            <div class="chart-wrapper">
                                <div class="chart-header">ğŸ“ˆ æ”¶ç›Šä¸æ”¶ç›Šç‡å˜åŒ–è¶‹åŠ¿</div>
                                <canvas id="strategyA-profitChart"></canvas>
                            </div>
                            <div class="chart-wrapper">
                                <div class="chart-header">ğŸ’° ä¹°å…¥è®¡åˆ’åˆ†å¸ƒä¸æˆæœ¬åˆ†æ</div>
                                <canvas id="strategyA-buyPlanChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="strategyB" class="tab-content">
                <div class="card">
                    <div class="card-header">ç­–ç•¥Bï¼šä¸‹è·Œ10%æ—¶ä¹°å…¥3æ‰‹</div>
                    <div class="card-body">
                        <div class="summary-box">
                            <div class="summary-item">
                                <div class="summary-value" id="strategyB-totalShares">0</div>
                                <div class="summary-label">æŒæœ‰è‚¡æ•°</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" id="strategyB-totalSpent">0</div>
                                <div class="summary-label">æ€»æ”¯å‡º</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" id="strategyB-remainingBudget">0</div>
                                <div class="summary-label">å‰©ä½™é¢„ç®—</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" id="strategyB-averageCost">0</div>
                                <div class="summary-label">å¹³å‡æˆæœ¬</div>
                            </div>
                        </div>
                        
                        <h3>ä¹°å…¥è®¡åˆ’</h3>
                        <div class="table-container">
                            <table id="strategyB-buyPlan">
                                <thead>
                                    <tr>
                                        <th>åºå·</th>
                                        <th>é¢„æœŸä»·æ ¼</th>
                                        <th>è´­å…¥æ‰‹æ•°</th>
                                        <th>è´­å…¥è‚¡æ•°</th>
                                        <th>æ”¯å‡º</th>
                                        <th>ç´¯è®¡æ”¯å‡º</th>
                                        <th>å‰©ä½™é¢„ç®—</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- åŠ¨æ€ç”Ÿæˆçš„è¡¨æ ¼è¡Œ -->
                                </tbody>
                            </table>
                        </div>
                        
                        <h3 style="margin-top: 30px;">æ”¶ç›Šåˆ†æ</h3>
                        <div class="table-container">
                            <table id="strategyB-profitAnalysis">
                                <thead>
                                    <tr>
                                        <th>ç›®æ ‡ä»·æ ¼</th>
                                        <th>å…¬å¸å¸‚å€¼</th>
                                        <th>æŒä»“ä»·å€¼</th>
                                        <th>æ”¶ç›Š</th>
                                        <th>æ”¶ç›Šç‡</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- åŠ¨æ€ç”Ÿæˆçš„è¡¨æ ¼è¡Œ -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="charts-container">
                            <div class="chart-wrapper">
                                <div class="chart-header">ğŸ“ˆ æ”¶ç›Šä¸æ”¶ç›Šç‡å˜åŒ–è¶‹åŠ¿</div>
                                <canvas id="strategyB-profitChart"></canvas>
                            </div>
                            <div class="chart-wrapper">
                                <div class="chart-header">ğŸ’° ä¹°å…¥è®¡åˆ’åˆ†å¸ƒä¸æˆæœ¬åˆ†æ</div>
                                <canvas id="strategyB-buyPlanChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="comparison" class="tab-content">
                <div class="card">
                    <div class="card-header">ç­–ç•¥å¯¹æ¯”åˆ†æ</div>
                    <div class="card-body">
                        <div class="charts-container">
                            <div class="chart-wrapper">
                                <div class="chart-header">ğŸ“Š ç­–ç•¥æ”¶ç›Šå¯¹æ¯”åˆ†æ</div>
                                <canvas id="comparison-profitChart"></canvas>
                            </div>
                            <div class="chart-wrapper">
                                <div class="chart-header">ğŸ“ˆ ç­–ç•¥æ”¶ç›Šç‡å¯¹æ¯”è¶‹åŠ¿</div>
                                <canvas id="comparison-rateChart"></canvas>
                            </div>
                        </div>
                        
                        <h3 style="margin-top: 30px;">ç­–ç•¥å…³é”®æŒ‡æ ‡å¯¹æ¯”</h3>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>æŒ‡æ ‡</th>
                                        <th>ç­–ç•¥A</th>
                                        <th>ç­–ç•¥B</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>æ€»æ”¯å‡º</td>
                                        <td id="comparison-totalSpent-A">0</td>
                                        <td id="comparison-totalSpent-B">0</td>
                                    </tr>
                                    <tr>
                                        <td>æŒæœ‰è‚¡æ•°</td>
                                        <td id="comparison-totalShares-A">0</td>
                                        <td id="comparison-totalShares-B">0</td>
                                    </tr>
                                    <tr>
                                        <td>å¹³å‡æˆæœ¬</td>
                                        <td id="comparison-averageCost-A">0</td>
                                        <td id="comparison-averageCost-B">0</td>
                                    </tr>
                                    <tr>
                                        <td>ç›ˆäºå¹³è¡¡ç‚¹</td>
                                        <td id="comparison-breakEven-A">0</td>
                                        <td id="comparison-breakEven-B">0</td>
                                    </tr>
                                    <tr>
                                        <td>å›æœ¬æ‰€éœ€æ¶¨å¹…</td>
                                        <td id="comparison-returnRate-A">0</td>
                                        <td id="comparison-returnRate-B">0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="card" style="margin-top: 30px;">
                            <div class="card-header">ç­–ç•¥å»ºè®®</div>
                            <div class="card-body">
                                <p id="strategy-suggestion">è¯·å…ˆç”Ÿæˆç­–ç•¥åˆ†æä»¥è·å–å»ºè®®ã€‚</p>
                            </div>
                        </div>
                        

                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>è‚¡ç¥¨äº¤æ˜“ç­–ç•¥åˆ†æå·¥å…· &copy; 2025 | æœ¬å·¥å…·ä»…ä¾›å­¦ä¹ å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®</p>
            <p>ä½œè€…: <a href="https://github.com/liu-kaining" target="_blank" style="color: #3498db; text-decoration: none;">liukaining</a> | <a href="https://github.com/liu-kaining" target="_blank" style="color: #3498db; text-decoration: none;">@https://github.com/liu-kaining</a></p>
        </footer>
    </div>

    <script>
        // å…¨å±€å˜é‡å­˜å‚¨ç­–ç•¥æ•°æ®
        let strategyAData = null;
        let strategyBData = null;
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabId) {
            // ç§»é™¤æ‰€æœ‰activeç±»
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // æ·»åŠ activeç±»åˆ°é€‰ä¸­çš„æ ‡ç­¾é¡µ
            const tabElement = document.querySelector(`[onclick="switchTab('${tabId}')"]`);
            if (tabElement) {
                tabElement.classList.add('active');
            }
            const contentElement = document.getElementById(tabId);
            if (contentElement) {
                contentElement.classList.add('active');
            }
        }
        
        // æ›´æ–°å¸‚åœºè®¾ç½®
        function updateMarketSettings() {
            const marketType = document.getElementById('marketType').value;
            
            if (marketType === 'US') {
                // ç¾è‚¡è®¾ç½®
                document.getElementById('currentPrice').value = '329';
                document.getElementById('historicalHigh').value = '488.54';
                document.getElementById('historicalLow').value = '0.999';
                document.getElementById('week52High').value = '488.54';
                document.getElementById('week52Low').value = '193.67';
                document.getElementById('marketCap').value = '10600';
                document.getElementById('totalShares').value = '32.25';
                document.getElementById('sharesPerHand').value = '1';
                document.getElementById('totalBudget').value = '50000';
                document.getElementById('companyName').value = 'ç‰¹æ–¯æ‹‰';
                document.getElementById('stockCode').value = 'TSLA';
                document.getElementById('budgetUnit').textContent = 'ç¾å…ƒ';
                document.getElementById('marketCapUnit').textContent = 'äº¿ç¾å…ƒ';
            } else {
                // æ¸¯è‚¡è®¾ç½®
                document.getElementById('currentPrice').value = '11.19';
                document.getElementById('historicalHigh').value = '22.83';
                document.getElementById('historicalLow').value = '0.43';
                document.getElementById('week52High').value = '12.56';
                document.getElementById('week52Low').value = '1.90';
                document.getElementById('marketCap').value = '510.96';
                document.getElementById('totalShares').value = '45.6';
                document.getElementById('sharesPerHand').value = '500';
                document.getElementById('totalBudget').value = '32000';
                document.getElementById('companyName').value = 'ç¾å›¾';
                document.getElementById('stockCode').value = '01357';
                document.getElementById('budgetUnit').textContent = 'æ¸¯å…ƒ';
                document.getElementById('marketCapUnit').textContent = 'äº¿æ¸¯å…ƒ';
            }
            validateForm(); // æ›´æ–°å¸‚åœºè®¾ç½®åéªŒè¯è¡¨å•
        }
        
        // éªŒè¯è¡¨å•
        function validateForm() {
            const requiredFields = [
                'companyName', 'stockCode', 'currentPrice', 'historicalHigh', 'historicalLow',
                'week52High', 'week52Low', 'marketCap', 'totalShares', 'sharesPerHand',
                'strategyACondition', 'strategyAPercentage', 'strategyAHands',
                'strategyBCondition', 'strategyBPercentage', 'strategyBHands',
                'totalBudget', 'maxBuys'
            ];
            
            let isValid = true;
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                const value = field.value.trim();
                
                if (!value || value === '') {
                    isValid = false;
                    field.style.borderColor = '#e74c3c';
                } else {
                    field.style.borderColor = '#ddd';
                }
            });
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const generateBtn = document.getElementById('generateStrategyBtn');
            if (isValid) {
                generateBtn.disabled = false;
                generateBtn.style.opacity = '1';
                generateBtn.style.cursor = 'pointer';
            } else {
                generateBtn.disabled = true;
                generateBtn.style.opacity = '0.6';
                generateBtn.style.cursor = 'not-allowed';
            }
            
            return isValid;
        }
        
        // æ·»åŠ è¾“å…¥äº‹ä»¶ç›‘å¬å™¨
        function addInputListeners() {
            const requiredFields = [
                'companyName', 'stockCode', 'currentPrice', 'historicalHigh', 'historicalLow',
                'week52High', 'week52Low', 'marketCap', 'totalShares', 'sharesPerHand',
                'strategyACondition', 'strategyAPercentage', 'strategyAHands',
                'strategyBCondition', 'strategyBPercentage', 'strategyBHands',
                'totalBudget', 'maxBuys'
            ];
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', validateForm);
                    field.addEventListener('change', validateForm);
                }
            });
        }
        
        // æ›´æ–°ç­–ç•¥æ ‡é¢˜
        function updateStrategyTitles(strategyACondition, strategyAPercentage, strategyAHands, 
                                   strategyBCondition, strategyBPercentage, strategyBHands) {
            const conditionTextA = strategyACondition === 'down' ? 'ä¸‹è·Œ' : 'ä¸Šæ¶¨';
            const conditionTextB = strategyBCondition === 'down' ? 'ä¸‹è·Œ' : 'ä¸Šæ¶¨';
            
            const strategyAHeader = document.querySelector('#strategyA .card-header');
            const strategyBHeader = document.querySelector('#strategyB .card-header');
            
            if (strategyAHeader) {
                strategyAHeader.textContent = `ç­–ç•¥Aï¼š${conditionTextA}${strategyAPercentage}%æ—¶ä¹°å…¥${strategyAHands}æ‰‹`;
            }
            if (strategyBHeader) {
                strategyBHeader.textContent = `ç­–ç•¥Bï¼š${conditionTextB}${strategyBPercentage}%æ—¶ä¹°å…¥${strategyBHands}æ‰‹`;
            }
        }
        

        
        // è®¡ç®—ç­–ç•¥
        function calculateStrategies() {
            // éªŒè¯è¡¨å•
            if (!validateForm()) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼');
                return;
            }
            
            // è·å–è¾“å…¥å€¼
            const currentPrice = parseFloat(document.getElementById('currentPrice').value);
            const totalBudget = parseFloat(document.getElementById('totalBudget').value);
            const maxBuys = parseInt(document.getElementById('maxBuys').value);
            const sharesPerHand = parseInt(document.getElementById('sharesPerHand').value);
            
            // è·å–ç­–ç•¥Aå‚æ•°
            const strategyACondition = document.getElementById('strategyACondition').value;
            const strategyAPercentage = parseFloat(document.getElementById('strategyAPercentage').value) / 100;
            const strategyAHands = parseInt(document.getElementById('strategyAHands').value);
            
            // è·å–ç­–ç•¥Bå‚æ•°
            const strategyBCondition = document.getElementById('strategyBCondition').value;
            const strategyBPercentage = parseFloat(document.getElementById('strategyBPercentage').value) / 100;
            const strategyBHands = parseInt(document.getElementById('strategyBHands').value);
            
            // æ›´æ–°ç­–ç•¥æ ‡é¢˜
            updateStrategyTitles(strategyACondition, strategyAPercentage * 100, strategyAHands, 
                               strategyBCondition, strategyBPercentage * 100, strategyBHands);
            
            // è®¡ç®—ç­–ç•¥A
            strategyAData = calculateStrategy(
                currentPrice, 
                totalBudget, 
                maxBuys, 
                sharesPerHand, 
                strategyACondition, 
                strategyAPercentage, 
                strategyAHands,
                'A'
            );
            
            // è®¡ç®—ç­–ç•¥B
            strategyBData = calculateStrategy(
                currentPrice, 
                totalBudget, 
                maxBuys, 
                sharesPerHand, 
                strategyBCondition, 
                strategyBPercentage, 
                strategyBHands,
                'B'
            );
            

            
            // æ˜¾ç¤ºç»“æœ
            displayResults();
            
            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            document.getElementById('results').style.display = 'block';
        }
        
        // è®¡ç®—å•ä¸ªç­–ç•¥
        function calculateStrategy(currentPrice, totalBudget, maxBuys, sharesPerHand, condition, percentage, hands, strategyName) {
            const data = {
                buyPlan: [],
                profitAnalysis: [],
                totalShares: 0,
                totalSpent: 0,
                remainingBudget: totalBudget,
                averageCost: 0
            };
            
            let currentPriceCalc = currentPrice;
            let remainingBudget = totalBudget;
            let totalSpent = 0;
            let totalShares = 0;
            
            // è®¡ç®—ä¹°å…¥è®¡åˆ’
            for (let i = 0; i < maxBuys; i++) {
                // æ ¹æ®æ¡ä»¶è°ƒæ•´ä»·æ ¼
                let buyPrice;
                if (condition === 'down') {
                    buyPrice = currentPriceCalc * Math.pow(1 - percentage, i);
                } else {
                    buyPrice = currentPriceCalc * Math.pow(1 + percentage, i);
                }
                
                // ä¼˜åŒ–ä»·æ ¼ç²¾åº¦ï¼Œä½¿å…¶æ›´å®ç”¨
                const marketType = document.getElementById('marketType').value;
                if (marketType === 'US') {
                    // ç¾è‚¡ï¼šä»·æ ¼ä¿ç•™åˆ°æ•´æ•°
                    buyPrice = Math.round(buyPrice);
                } else {
                    // æ¸¯è‚¡ï¼šä»·æ ¼ä¿ç•™åˆ°0.1æ¸¯å…ƒ
                    buyPrice = Math.round(buyPrice * 10) / 10;
                }
                
                const sharesToBuy = hands * sharesPerHand;
                const cost = sharesToBuy * buyPrice;
                
                // æ£€æŸ¥é¢„ç®—æ˜¯å¦è¶³å¤Ÿ
                if (remainingBudget < cost) {
                    break;
                }
                
                // æ›´æ–°æ•°æ®
                remainingBudget -= cost;
                totalSpent += cost;
                totalShares += sharesToBuy;
                
                // æ·»åŠ åˆ°ä¹°å…¥è®¡åˆ’
                data.buyPlan.push({
                    sequence: i + 1,
                    price: buyPrice,
                    hands: hands,
                    shares: sharesToBuy,
                    cost: cost,
                    cumulativeCost: totalSpent,
                    remainingBudget: remainingBudget
                });
            }
            
            // è®¡ç®—å¹³å‡æˆæœ¬
            data.totalShares = totalShares;
            data.totalSpent = totalSpent;
            data.remainingBudget = remainingBudget;
            data.averageCost = totalShares > 0 ? totalSpent / totalShares : 0;
            
            // è®¡ç®—æ”¶ç›Šåˆ†æ (ç›®æ ‡ä»·æ ¼ä½¿ç”¨æ›´å®ç”¨çš„ä»·æ ¼åŒºé—´)
            const marketType = document.getElementById('marketType').value;
            const marketCap = parseFloat(document.getElementById('marketCap').value) * 100000000; // è½¬æ¢ä¸ºåŸºç¡€è´§å¸å•ä½
            const totalSharesCount = parseFloat(document.getElementById('totalShares').value) * 100000000; // è½¬æ¢ä¸ºè‚¡æ•°
            const historicalHigh = parseFloat(document.getElementById('historicalHigh').value); // å†å²æœ€é«˜ä»·
            
            // è®¡ç®—ç›®æ ‡ä»·æ ¼èŒƒå›´ï¼šä½¿ç”¨æ›´å®ç”¨çš„ä»·æ ¼åŒºé—´
            let minPrice, maxPrice;
            
            if (marketType === 'US') {
                // ç¾è‚¡ï¼šä»å½“å‰ä»·æ ¼çš„80%åˆ°å†å²æœ€é«˜ä»·çš„120%ï¼Œä½¿ç”¨æ•´æ•°ä»·æ ¼
                minPrice = Math.floor(currentPrice * 0.8);
                maxPrice = Math.ceil(historicalHigh * 1.2);
                // æ¯5ç¾å…ƒä¸€ä¸ªä»·æ ¼ç‚¹
                const stepSize = 5;
                for (let price = minPrice; price <= maxPrice; price += stepSize) {
                    const targetPrice = price;
                    const holdingValue = totalShares * targetPrice;
                    const profit = holdingValue - totalSpent;
                    const profitRate = totalSpent > 0 ? (profit / totalSpent) * 100 : 0;
                    const companyMarketCap = (targetPrice / currentPrice) * marketCap / 100000000; // è½¬æ¢ä¸ºäº¿å•ä½
                    
                    data.profitAnalysis.push({
                        targetPrice: targetPrice,
                        companyMarketCap: companyMarketCap,
                        holdingValue: holdingValue,
                        profit: profit,
                        profitRate: profitRate
                    });
                }
            } else {
                // æ¸¯è‚¡ï¼šä»å½“å‰ä»·æ ¼çš„80%åˆ°å†å²æœ€é«˜ä»·çš„120%ï¼Œä½¿ç”¨0.5æ¸¯å…ƒçš„ä»·æ ¼ç‚¹
                minPrice = Math.floor(currentPrice * 0.8 * 2) / 2;
                maxPrice = Math.ceil(historicalHigh * 1.2 * 2) / 2;
                // æ¯0.5æ¸¯å…ƒä¸€ä¸ªä»·æ ¼ç‚¹
                const stepSize = 0.5;
                for (let price = minPrice; price <= maxPrice; price += stepSize) {
                    const targetPrice = Math.round(price * 2) / 2; // ä¿ç•™ä¸€ä½å°æ•°
                    const holdingValue = totalShares * targetPrice;
                    const profit = holdingValue - totalSpent;
                    const profitRate = totalSpent > 0 ? (profit / totalSpent) * 100 : 0;
                    const companyMarketCap = (targetPrice / currentPrice) * marketCap / 100000000; // è½¬æ¢ä¸ºäº¿å•ä½
                    
                    data.profitAnalysis.push({
                        targetPrice: targetPrice,
                        companyMarketCap: companyMarketCap,
                        holdingValue: holdingValue,
                        profit: profit,
                        profitRate: profitRate
                    });
                }
            }
            
            return data;
        }
        
        // æ˜¾ç¤ºç»“æœ
        function displayResults() {
            // æ˜¾ç¤ºç­–ç•¥Aç»“æœ
            displayStrategyA();
            
            // æ˜¾ç¤ºç­–ç•¥Bç»“æœ
            displayStrategyB();
            
            // æ˜¾ç¤ºå¯¹æ¯”ç»“æœ
            displayComparison();
            
            // ç”Ÿæˆå»ºè®®
            generateSuggestion();
        }
        
        // æ˜¾ç¤ºç­–ç•¥Aç»“æœ
        function displayStrategyA() {
            // æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨
            if (!strategyAData) {
                console.error('ç­–ç•¥Aæ•°æ®ä¸å­˜åœ¨');
                return;
            }
            
            // æ›´æ–°æ‘˜è¦
            document.getElementById('strategyA-totalShares').textContent = formatNumber(strategyAData.totalShares);
            document.getElementById('strategyA-totalSpent').textContent = formatCurrency(strategyAData.totalSpent);
            document.getElementById('strategyA-remainingBudget').textContent = formatCurrency(strategyAData.remainingBudget);
            document.getElementById('strategyA-averageCost').textContent = strategyAData.averageCost.toFixed(2);
            
            // æ¸…ç©ºè¡¨æ ¼
            const buyPlanTable = document.getElementById('strategyA-buyPlan').getElementsByTagName('tbody')[0];
            buyPlanTable.innerHTML = '';
            
            // å¡«å……ä¹°å…¥è®¡åˆ’è¡¨æ ¼
            if (strategyAData.buyPlan && strategyAData.buyPlan.length > 0) {
                strategyAData.buyPlan.forEach(buy => {
                    const row = buyPlanTable.insertRow();
                    row.innerHTML = `
                        <td>${buy.sequence}</td>
                        <td>${formatPrice(buy.price)}</td>
                        <td>${buy.hands}</td>
                        <td>${formatNumber(buy.shares)}</td>
                        <td>${formatCurrency(buy.cost)}</td>
                        <td>${formatCurrency(buy.cumulativeCost)}</td>
                        <td>${formatCurrency(buy.remainingBudget)}</td>
                    `;
                });
            }
            
            // æ¸…ç©ºæ”¶ç›Šåˆ†æè¡¨æ ¼
            const profitAnalysisTable = document.getElementById('strategyA-profitAnalysis').getElementsByTagName('tbody')[0];
            profitAnalysisTable.innerHTML = '';
            
            // å¡«å……æ”¶ç›Šåˆ†æè¡¨æ ¼
            if (strategyAData.profitAnalysis && strategyAData.profitAnalysis.length > 0) {
                strategyAData.profitAnalysis.forEach(item => {
                    if (item.targetPrice >= (strategyAData.buyPlan[0]?.price || 0) * 0.8) {
                        const row = profitAnalysisTable.insertRow();
                        
                        let profitClass = 'neutral';
                        if (item.profit > 0) profitClass = 'positive';
                        if (item.profit < 0) profitClass = 'negative';
                        
                        let rateClass = 'neutral';
                        if (item.profitRate > 0) rateClass = 'positive';
                        if (item.profitRate < 0) rateClass = 'negative';
                        
                        row.innerHTML = `
                            <td>${item.targetPrice.toFixed(2)}</td>
                            <td>${item.companyMarketCap.toFixed(3)}</td>
                            <td>${formatCurrency(item.holdingValue)}</td>
                            <td class="${profitClass}">${formatCurrency(item.profit)}</td>
                            <td class="${rateClass}">${item.profitRate.toFixed(2)}%</td>
                        `;
                    }
                });
            }
            
            // ç”Ÿæˆå›¾è¡¨
            generateStrategyACharts();
        }
        
        // æ˜¾ç¤ºç­–ç•¥Bç»“æœ
        function displayStrategyB() {
            // æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨
            if (!strategyBData) {
                console.error('ç­–ç•¥Bæ•°æ®ä¸å­˜åœ¨');
                return;
            }
            
            // æ›´æ–°æ‘˜è¦
            document.getElementById('strategyB-totalShares').textContent = formatNumber(strategyBData.totalShares);
            document.getElementById('strategyB-totalSpent').textContent = formatCurrency(strategyBData.totalSpent);
            document.getElementById('strategyB-remainingBudget').textContent = formatCurrency(strategyBData.remainingBudget);
            document.getElementById('strategyB-averageCost').textContent = strategyBData.averageCost.toFixed(2);
            
            // æ¸…ç©ºè¡¨æ ¼
            const buyPlanTable = document.getElementById('strategyB-buyPlan').getElementsByTagName('tbody')[0];
            buyPlanTable.innerHTML = '';
            
            // å¡«å……ä¹°å…¥è®¡åˆ’è¡¨æ ¼
            if (strategyBData.buyPlan && strategyBData.buyPlan.length > 0) {
                strategyBData.buyPlan.forEach(buy => {
                    const row = buyPlanTable.insertRow();
                    row.innerHTML = `
                        <td>${buy.sequence}</td>
                        <td>${formatPrice(buy.price)}</td>
                        <td>${buy.hands}</td>
                        <td>${formatNumber(buy.shares)}</td>
                        <td>${formatCurrency(buy.cost)}</td>
                        <td>${formatCurrency(buy.cumulativeCost)}</td>
                        <td>${formatCurrency(buy.remainingBudget)}</td>
                    `;
                });
            }
            
            // æ¸…ç©ºæ”¶ç›Šåˆ†æè¡¨æ ¼
            const profitAnalysisTable = document.getElementById('strategyB-profitAnalysis').getElementsByTagName('tbody')[0];
            profitAnalysisTable.innerHTML = '';
            
            // å¡«å……æ”¶ç›Šåˆ†æè¡¨æ ¼
            if (strategyBData.profitAnalysis && strategyBData.profitAnalysis.length > 0) {
                strategyBData.profitAnalysis.forEach(item => {
                    if (item.targetPrice >= (strategyBData.buyPlan[0]?.price || 0) * 0.8) {
                        const row = profitAnalysisTable.insertRow();
                        
                        let profitClass = 'neutral';
                        if (item.profit > 0) profitClass = 'positive';
                        if (item.profit < 0) profitClass = 'negative';
                        
                        let rateClass = 'neutral';
                        if (item.profitRate > 0) rateClass = 'positive';
                        if (item.profitRate < 0) rateClass = 'negative';
                        
                        row.innerHTML = `
                            <td>${item.targetPrice.toFixed(2)}</td>
                            <td>${item.companyMarketCap.toFixed(3)}</td>
                            <td>${formatCurrency(item.holdingValue)}</td>
                            <td class="${profitClass}">${formatCurrency(item.profit)}</td>
                            <td class="${rateClass}">${item.profitRate.toFixed(2)}%</td>
                        `;
                    }
                });
            }
            
            // ç”Ÿæˆå›¾è¡¨
            generateStrategyBCharts();
        }
        
        // æ˜¾ç¤ºå¯¹æ¯”ç»“æœ
        function displayComparison() {
            // æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨
            if (!strategyAData || !strategyBData) {
                console.error('å¯¹æ¯”æ•°æ®ä¸å­˜åœ¨');
                return;
            }
            
            // æ›´æ–°å¯¹æ¯”è¡¨æ ¼
            document.getElementById('comparison-totalSpent-A').textContent = formatCurrency(strategyAData.totalSpent);
            document.getElementById('comparison-totalSpent-B').textContent = formatCurrency(strategyBData.totalSpent);
            document.getElementById('comparison-totalShares-A').textContent = formatNumber(strategyAData.totalShares);
            document.getElementById('comparison-totalShares-B').textContent = formatNumber(strategyBData.totalShares);
            document.getElementById('comparison-averageCost-A').textContent = strategyAData.averageCost.toFixed(2);
            document.getElementById('comparison-averageCost-B').textContent = strategyBData.averageCost.toFixed(2);
            document.getElementById('comparison-breakEven-A').textContent = strategyAData.averageCost.toFixed(2);
            document.getElementById('comparison-breakEven-B').textContent = strategyBData.averageCost.toFixed(2);
            
            const returnRateA = ((strategyAData.averageCost - parseFloat(document.getElementById('currentPrice').value)) / parseFloat(document.getElementById('currentPrice').value) * 100);
            const returnRateB = ((strategyBData.averageCost - parseFloat(document.getElementById('currentPrice').value)) / parseFloat(document.getElementById('currentPrice').value) * 100);
            
            document.getElementById('comparison-returnRate-A').textContent = returnRateA > 0 ? `+${returnRateA.toFixed(2)}%` : `${returnRateA.toFixed(2)}%`;
            document.getElementById('comparison-returnRate-B').textContent = returnRateB > 0 ? `+${returnRateB.toFixed(2)}%` : `${returnRateB.toFixed(2)}%`;
            
            // ç”Ÿæˆå¯¹æ¯”å›¾è¡¨
            generateComparisonCharts();
        }
        
        // ç”Ÿæˆç­–ç•¥Aå›¾è¡¨
        function generateStrategyACharts() {
            // æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨
            if (!strategyAData || !strategyAData.profitAnalysis || strategyAData.profitAnalysis.length === 0) {
                console.error('ç­–ç•¥Aæ•°æ®ä¸å­˜åœ¨æˆ–ä¸ºç©º');
                return;
            }
            
            // æ”¶ç›Šä¸æ”¶ç›Šç‡å›¾è¡¨
            const profitCtx = document.getElementById('strategyA-profitChart').getContext('2d');
            const filteredAnalysis = strategyAData.profitAnalysis.filter(item => 
                item.targetPrice >= (strategyAData.buyPlan[0]?.price || 0) * 0.8
            );
            
            if (filteredAnalysis.length === 0) {
                console.error('ç­–ç•¥Aè¿‡æ»¤åçš„æ•°æ®ä¸ºç©º');
                return;
            }
            
            const profitLabels = filteredAnalysis.map(item => item.targetPrice.toFixed(1));
            const holdingValues = filteredAnalysis.map(item => item.holdingValue);
            const profits = filteredAnalysis.map(item => item.profit);
            const profitRates = filteredAnalysis.map(item => item.profitRate);
            
            if (window.strategyAProfitChart) {
                window.strategyAProfitChart.destroy();
            }
            
            const marketTypeAProfit = document.getElementById('marketType').value;
            const currencyUnitAProfit = marketTypeAProfit === 'US' ? 'ç¾å…ƒ' : 'æ¸¯å…ƒ';
            
            window.strategyAProfitChart = new Chart(profitCtx, {
                type: 'line',
                data: {
                    labels: profitLabels,
                    datasets: [
                        {
                            label: `æŒä»“ä»·å€¼ (${currencyUnitAProfit})`,
                            data: holdingValues,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.2)',
                            borderWidth: 3,
                            yAxisID: 'y',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBackgroundColor: '#3498db',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2
                        },
                        {
                            label: `æ”¶ç›Š (${currencyUnitAProfit})`,
                            data: profits,
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 136, 0.2)',
                            borderWidth: 3,
                            yAxisID: 'y',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBackgroundColor: '#2ecc71',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2
                        },
                        {
                            label: 'æ”¶ç›Šç‡ (%)',
                            data: profitRates,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.2)',
                            borderWidth: 3,
                            yAxisID: 'y1',
                            tension: 0.4,
                            fill: false,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBackgroundColor: '#e74c3c',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    stacked: false,
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    },
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: `é‡‘é¢ (${currencyUnitAProfit})`,
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'æ”¶ç›Šç‡ (%)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        }
                    }
                }
            });
            
            // ä¹°å…¥è®¡åˆ’å›¾è¡¨
            const buyPlanCtx = document.getElementById('strategyA-buyPlanChart').getContext('2d');
            
            // æ£€æŸ¥ä¹°å…¥è®¡åˆ’æ•°æ®
            if (!strategyAData.buyPlan || strategyAData.buyPlan.length === 0) {
                console.error('ç­–ç•¥Aä¹°å…¥è®¡åˆ’æ•°æ®ä¸ºç©º');
                return;
            }
            
            const buyPlanLabels = strategyAData.buyPlan.map(item => `ç¬¬${item.sequence}æ¬¡`);
            const buyPrices = strategyAData.buyPlan.map(item => item.price);
            const buyCosts = strategyAData.buyPlan.map(item => item.cost);
            
            if (window.strategyABuyPlanChart) {
                window.strategyABuyPlanChart.destroy();
            }
            
            const marketTypeA = document.getElementById('marketType').value;
            const currencySymbolA = marketTypeA === 'US' ? '$' : 'HK$';
            const currencyUnitA = marketTypeA === 'US' ? 'ç¾å…ƒ' : 'æ¸¯å…ƒ';
            
            window.strategyABuyPlanChart = new Chart(buyPlanCtx, {
                type: 'bar',
                data: {
                    labels: buyPlanLabels,
                    datasets: [
                        {
                            label: `ä¹°å…¥ä»·æ ¼ (${currencySymbolA})`,
                            data: buyPrices,
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.8)',
                            type: 'line',
                            order: 1,
                            borderWidth: 4,
                            pointRadius: 8,
                            pointHoverRadius: 10,
                            pointBackgroundColor: '#9b59b6',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 3,
                            tension: 0.4,
                            yAxisID: 'y1'
                        },
                        {
                            label: `æ”¯å‡º (${currencyUnitA})`,
                            data: buyCosts,
                            backgroundColor: [
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(155, 89, 182, 0.8)',
                                'rgba(231, 76, 60, 0.8)',
                                'rgba(243, 156, 18, 0.8)',
                                'rgba(26, 188, 156, 0.8)',
                                'rgba(52, 73, 94, 0.8)',
                                'rgba(155, 89, 182, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(231, 76, 60, 0.8)'
                            ],
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 2,
                            borderRadius: 8,
                            order: 0,
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeInOutQuart'
                    },
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: `æ”¯å‡º (${currencyUnitA})`,
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: `ä¹°å…¥ä»·æ ¼ (${currencySymbolA})`,
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // ç”Ÿæˆç­–ç•¥Bå›¾è¡¨
        function generateStrategyBCharts() {
            // æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨
            if (!strategyBData || !strategyBData.profitAnalysis || strategyBData.profitAnalysis.length === 0) {
                console.error('ç­–ç•¥Bæ•°æ®ä¸å­˜åœ¨æˆ–ä¸ºç©º');
                return;
            }
            
            // æ”¶ç›Šä¸æ”¶ç›Šç‡å›¾è¡¨
            const profitCtx = document.getElementById('strategyB-profitChart').getContext('2d');
            const filteredAnalysis = strategyBData.profitAnalysis.filter(item => 
                item.targetPrice >= (strategyBData.buyPlan[0]?.price || 0) * 0.8
            );
            
            if (filteredAnalysis.length === 0) {
                console.error('ç­–ç•¥Bè¿‡æ»¤åçš„æ•°æ®ä¸ºç©º');
                return;
            }
            
            const profitLabels = filteredAnalysis.map(item => item.targetPrice.toFixed(1));
            const holdingValues = filteredAnalysis.map(item => item.holdingValue);
            const profits = filteredAnalysis.map(item => item.profit);
            const profitRates = filteredAnalysis.map(item => item.profitRate);
            
            if (window.strategyBProfitChart) {
                window.strategyBProfitChart.destroy();
            }
            
            const marketTypeBProfit = document.getElementById('marketType').value;
            const currencyUnitBProfit = marketTypeBProfit === 'US' ? 'ç¾å…ƒ' : 'æ¸¯å…ƒ';
            
            window.strategyBProfitChart = new Chart(profitCtx, {
                type: 'line',
                data: {
                    labels: profitLabels,
                    datasets: [
                        {
                            label: `æŒä»“ä»·å€¼ (${currencyUnitBProfit})`,
                            data: holdingValues,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.2)',
                            borderWidth: 3,
                            yAxisID: 'y',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBackgroundColor: '#3498db',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2
                        },
                        {
                            label: `æ”¶ç›Š (${currencyUnitBProfit})`,
                            data: profits,
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 136, 0.2)',
                            borderWidth: 3,
                            yAxisID: 'y',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBackgroundColor: '#2ecc71',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2
                        },
                        {
                            label: 'æ”¶ç›Šç‡ (%)',
                            data: profitRates,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.2)',
                            borderWidth: 3,
                            yAxisID: 'y1',
                            tension: 0.4,
                            fill: false,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBackgroundColor: '#e74c3c',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    stacked: false,
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    },
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: `é‡‘é¢ (${currencyUnitBProfit})`,
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'æ”¶ç›Šç‡ (%)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        }
                    }
                }
            });
            
            // ä¹°å…¥è®¡åˆ’å›¾è¡¨
            const buyPlanCtx = document.getElementById('strategyB-buyPlanChart').getContext('2d');
            
            // æ£€æŸ¥ä¹°å…¥è®¡åˆ’æ•°æ®
            if (!strategyBData.buyPlan || strategyBData.buyPlan.length === 0) {
                console.error('ç­–ç•¥Bä¹°å…¥è®¡åˆ’æ•°æ®ä¸ºç©º');
                return;
            }
            
            const buyPlanLabels = strategyBData.buyPlan.map(item => `ç¬¬${item.sequence}æ¬¡`);
            const buyPrices = strategyBData.buyPlan.map(item => item.price);
            const buyCosts = strategyBData.buyPlan.map(item => item.cost);
            
            if (window.strategyBBuyPlanChart) {
                window.strategyBBuyPlanChart.destroy();
            }
            
            const marketTypeB = document.getElementById('marketType').value;
            const currencySymbolB = marketTypeB === 'US' ? '$' : 'HK$';
            const currencyUnitB = marketTypeB === 'US' ? 'ç¾å…ƒ' : 'æ¸¯å…ƒ';
            
            window.strategyBBuyPlanChart = new Chart(buyPlanCtx, {
                type: 'bar',
                data: {
                    labels: buyPlanLabels,
                    datasets: [
                        {
                            label: `ä¹°å…¥ä»·æ ¼ (${currencySymbolB})`,
                            data: buyPrices,
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.8)',
                            type: 'line',
                            order: 1,
                            borderWidth: 4,
                            pointRadius: 8,
                            pointHoverRadius: 10,
                            pointBackgroundColor: '#9b59b6',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 3,
                            tension: 0.4,
                            yAxisID: 'y1'
                        },
                        {
                            label: `æ”¯å‡º (${currencyUnitB})`,
                            data: buyCosts,
                            backgroundColor: [
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(155, 89, 182, 0.8)',
                                'rgba(231, 76, 60, 0.8)',
                                'rgba(243, 156, 18, 0.8)',
                                'rgba(26, 188, 156, 0.8)',
                                'rgba(52, 73, 94, 0.8)',
                                'rgba(155, 89, 182, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(231, 76, 60, 0.8)'
                            ],
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 2,
                            borderRadius: 8,
                            order: 0,
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeInOutQuart'
                    },
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: `æ”¯å‡º (${currencyUnitB})`,
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: `ä¹°å…¥ä»·æ ¼ (${currencySymbolB})`,
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // ç”Ÿæˆå¯¹æ¯”å›¾è¡¨
        function generateComparisonCharts() {
            // æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨
            if (!strategyAData || !strategyBData || 
                !strategyAData.profitAnalysis || !strategyBData.profitAnalysis ||
                strategyAData.profitAnalysis.length === 0 || strategyBData.profitAnalysis.length === 0) {
                console.error('å¯¹æ¯”å›¾è¡¨æ•°æ®ä¸å­˜åœ¨æˆ–ä¸ºç©º');
                return;
            }
            
            // æ”¶ç›Šå¯¹æ¯”å›¾è¡¨
            const profitCtx = document.getElementById('comparison-profitChart').getContext('2d');
            
            // æ‰¾åˆ°ä¸¤ä¸ªç­–ç•¥çš„å…±åŒä»·æ ¼èŒƒå›´
            const minPrice = Math.max(
                strategyAData.buyPlan[0]?.price || 0,
                strategyBData.buyPlan[0]?.price || 0
            ) * 0.8;
            
            const commonAnalysisA = strategyAData.profitAnalysis.filter(item => item.targetPrice >= minPrice);
            const commonAnalysisB = strategyBData.profitAnalysis.filter(item => item.targetPrice >= minPrice);
            
            // æ£€æŸ¥è¿‡æ»¤åçš„æ•°æ®
            if (commonAnalysisA.length === 0 || commonAnalysisB.length === 0) {
                console.error('å¯¹æ¯”å›¾è¡¨è¿‡æ»¤åçš„æ•°æ®ä¸ºç©º');
                return;
            }
            
            const profitLabels = commonAnalysisA.map(item => item.targetPrice.toFixed(1));
            const profitsA = commonAnalysisA.map(item => item.profit);
            const profitsB = commonAnalysisB.map(item => item.profit);
            const holdingValuesA = commonAnalysisA.map(item => item.holdingValue);
            const holdingValuesB = commonAnalysisB.map(item => item.holdingValue);
            
            if (window.comparisonProfitChart) {
                window.comparisonProfitChart.destroy();
            }
            
            const marketTypeComp = document.getElementById('marketType').value;
            const currencyUnitComp = marketTypeComp === 'US' ? 'ç¾å…ƒ' : 'æ¸¯å…ƒ';
            
            window.comparisonProfitChart = new Chart(profitCtx, {
                type: 'bar',
                data: {
                    labels: profitLabels,
                    datasets: [
                        {
                            label: `ç­–ç•¥A æ”¶ç›Š (${currencyUnitComp})`,
                            data: profitsA,
                            backgroundColor: [
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(52, 152, 219, 0.8)'
                            ],
                            borderColor: '#3498db',
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false
                        },
                        {
                            label: `ç­–ç•¥B æ”¶ç›Š (${currencyUnitComp})`,
                            data: profitsB,
                            backgroundColor: [
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(46, 204, 136, 0.8)',
                                'rgba(46, 204, 136, 0.8)'
                            ],
                            borderColor: '#2ecc71',
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 1500,
                        easing: 'easeInOutQuart'
                    },
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: `æ”¶ç›Š (${currencyUnitComp})`,
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        }
                    }
                }
            });
            
            // æ”¶ç›Šç‡å¯¹æ¯”å›¾è¡¨
            const rateCtx = document.getElementById('comparison-rateChart').getContext('2d');
            const profitRatesA = commonAnalysisA.map(item => item.profitRate);
            const profitRatesB = commonAnalysisB.map(item => item.profitRate);
            
            if (window.comparisonRateChart) {
                window.comparisonRateChart.destroy();
            }
            
            window.comparisonRateChart = new Chart(rateCtx, {
                type: 'line',
                data: {
                    labels: profitLabels,
                    datasets: [
                        {
                            label: 'ç­–ç•¥A æ”¶ç›Šç‡ (%)',
                            data: profitRatesA,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.2)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBackgroundColor: '#3498db',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2
                        },
                        {
                            label: 'ç­–ç•¥B æ”¶ç›Šç‡ (%)',
                            data: profitRatesB,
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 136, 0.2)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBackgroundColor: '#2ecc71',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    },
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'æ”¶ç›Šç‡ (%)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // ç”Ÿæˆå»ºè®®
        function generateSuggestion() {
            const suggestionElement = document.getElementById('strategy-suggestion');
            
            // æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨
            if (!strategyAData || !strategyBData) {
                suggestionElement.innerHTML = '<p>è¯·å…ˆç”Ÿæˆç­–ç•¥åˆ†æä»¥è·å–å»ºè®®ã€‚</p>';
                return;
            }
            
            const currentPrice = parseFloat(document.getElementById('currentPrice').value);
            const marketType = document.getElementById('marketType').value;
            const currencyUnit = marketType === 'US' ? 'ç¾å…ƒ' : 'æ¸¯å…ƒ';
            
            // ç®€å•çš„ç­–ç•¥å»ºè®®é€»è¾‘
            if (strategyAData.averageCost < currentPrice && strategyBData.averageCost > currentPrice) {
                suggestionElement.innerHTML = `
                    <p><strong>ç­–ç•¥å»ºè®®ï¼š</strong></p>
                    <p>å½“å‰è‚¡ä»·ä¸º ${currentPrice.toFixed(2)} ${currencyUnit}ï¼Œé«˜äºç­–ç•¥Açš„å¹³å‡æˆæœ¬(${strategyAData.averageCost.toFixed(2)} ${currencyUnit})ï¼Œä½†ä½äºç­–ç•¥Bçš„å¹³å‡æˆæœ¬(${strategyBData.averageCost.toFixed(2)} ${currencyUnit})ã€‚</p>
                    <p><strong>æ¨èç­–ç•¥A</strong>ï¼Œå› ä¸ºè¯¥ç­–ç•¥åœ¨è‚¡ä»·ä¸‹è·Œæ—¶é€æ­¥ä¹°å…¥ï¼Œæˆæœ¬è¾ƒä½ï¼Œå½“å‰å·²å¤„äºç›ˆåˆ©çŠ¶æ€ã€‚è¿™ç§ç­–ç•¥é€‚åˆéœ‡è¡å¸‚æˆ–é¢„æœŸè‚¡ä»·å¯èƒ½ç»§ç»­ä¸‹è·Œçš„å¸‚åœºç¯å¢ƒã€‚</p>
                    <p>ç­–ç•¥Béœ€è¦è‚¡ä»·è¿›ä¸€æ­¥ä¸Šæ¶¨æ‰èƒ½å›æœ¬ï¼Œé£é™©ç›¸å¯¹è¾ƒé«˜ã€‚</p>
                `;
            } else if (strategyAData.averageCost > currentPrice && strategyBData.averageCost < currentPrice) {
                suggestionElement.innerHTML = `
                    <p><strong>ç­–ç•¥å»ºè®®ï¼š</strong></p>
                    <p>å½“å‰è‚¡ä»·ä¸º ${currentPrice.toFixed(2)} ${currencyUnit}ï¼Œä½äºç­–ç•¥Açš„å¹³å‡æˆæœ¬(${strategyAData.averageCost.toFixed(2)} ${currencyUnit})ï¼Œä½†é«˜äºç­–ç•¥Bçš„å¹³å‡æˆæœ¬(${strategyBData.averageCost.toFixed(2)} ${currencyUnit})ã€‚</p>
                    <p><strong>æ¨èç­–ç•¥B</strong>ï¼Œå› ä¸ºè¯¥ç­–ç•¥åœ¨è‚¡ä»·ä¸Šæ¶¨æ—¶ä¹°å…¥ï¼Œè¡¨æ˜å¸‚åœºè¶‹åŠ¿å‘å¥½ï¼Œå½“å‰å·²å¤„äºç›ˆåˆ©çŠ¶æ€ã€‚è¿™ç§ç­–ç•¥é€‚åˆç‰›å¸‚æˆ–é¢„æœŸè‚¡ä»·å°†ç»§ç»­ä¸Šæ¶¨çš„å¸‚åœºç¯å¢ƒã€‚</p>
                    <p>ç­–ç•¥Aç›®å‰å¤„äºäºæŸçŠ¶æ€ï¼Œéœ€è¦è‚¡ä»·åå¼¹æ‰èƒ½å›æœ¬ã€‚</p>
                `;
            } else if (strategyAData.averageCost < strategyBData.averageCost) {
                suggestionElement.innerHTML = `
                    <p><strong>ç­–ç•¥å»ºè®®ï¼š</strong></p>
                    <p>ç­–ç•¥Açš„å¹³å‡æˆæœ¬(${strategyAData.averageCost.toFixed(2)} ${currencyUnit})ä½äºç­–ç•¥Bçš„å¹³å‡æˆæœ¬(${strategyBData.averageCost.toFixed(2)} ${currencyUnit})ã€‚</p>
                    <p>å¦‚æœé¢„æœŸå¸‚åœºå°†éœ‡è¡æˆ–ä¸‹è¡Œï¼Œ<strong>æ¨èç­–ç•¥A</strong>ï¼Œå› ä¸ºå®ƒé€šè¿‡åœ¨è‚¡ä»·ä¸‹è·Œæ—¶ä¹°å…¥ï¼Œæœ‰æ•ˆé™ä½äº†æŒä»“æˆæœ¬ï¼Œé£é™©ç›¸å¯¹è¾ƒå°ã€‚</p>
                    <p>å¦‚æœé¢„æœŸå¸‚åœºå°†å¼ºåŠ²ä¸Šæ¶¨ï¼Œå¯ä»¥è€ƒè™‘ç­–ç•¥Bï¼Œä½†éœ€è¦æ‰¿æ‹…æ›´é«˜çš„æˆæœ¬é£é™©ã€‚</p>
                `;
            } else {
                suggestionElement.innerHTML = `
                    <p><strong>ç­–ç•¥å»ºè®®ï¼š</strong></p>
                    <p>ä¸¤ç§ç­–ç•¥çš„å¹³å‡æˆæœ¬ç›¸è¿‘ï¼Œç­–ç•¥Aä¸º ${strategyAData.averageCost.toFixed(2)} ${currencyUnit}ï¼Œç­–ç•¥Bä¸º ${strategyBData.averageCost.toFixed(2)} ${currencyUnit}ã€‚</p>
                    <p>å¦‚æœå¸‚åœºè¶‹åŠ¿ä¸ç¡®å®šï¼Œ<strong>æ¨èç­–ç•¥A</strong>ï¼Œå› ä¸ºå®ƒåœ¨è‚¡ä»·ä¸‹è·Œæ—¶ä¹°å…¥ï¼Œå¯ä»¥æ›´å¥½åœ°æ§åˆ¶é£é™©ï¼Œé€‚åˆé•¿æœŸæŠ•èµ„ã€‚</p>
                    <p>å¦‚æœå¯¹å¸‚åœºä¸Šæ¶¨æœ‰è¾ƒå¼ºä¿¡å¿ƒï¼Œå¯ä»¥é€‰æ‹©ç­–ç•¥Bï¼Œä½†éœ€è¦æ³¨æ„æ§åˆ¶é£é™©ã€‚</p>
                `;
            }
        }
        
        // æ ¼å¼åŒ–æ•°å­—
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
        
        // æ ¼å¼åŒ–è´§å¸
        function formatCurrency(amount) {
            const marketType = document.getElementById('marketType').value;
            const currencySymbol = marketType === 'US' ? '$' : 'HK$';
            return currencySymbol + amount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // æ ¼å¼åŒ–ä»·æ ¼ (æ ¹æ®å¸‚åœºç±»å‹è°ƒæ•´ç²¾åº¦)
        function formatPrice(price) {
            const marketType = document.getElementById('marketType').value;
            if (marketType === 'US') {
                return price.toFixed(0); // ç¾è‚¡ä»·æ ¼ä¿ç•™æ•´æ•°
            } else {
                return price.toFixed(2); // æ¸¯è‚¡ä»·æ ¼ä¿ç•™ä¸¤ä½å°æ•°
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addInputListeners(); // æ·»åŠ è¾“å…¥äº‹ä»¶ç›‘å¬å™¨
            validateForm(); // åˆå§‹éªŒè¯è¡¨å•
            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ åˆå§‹æ•°æ®æˆ–ç¤ºä¾‹
            // calculateStrategies(); // å¦‚æœå¸Œæœ›é¡µé¢åŠ è½½åè‡ªåŠ¨è®¡ç®—ï¼Œå–æ¶ˆæ³¨é‡Šè¿™è¡Œ
        });
    </script>
</body>
</html>
